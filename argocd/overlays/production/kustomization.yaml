bases:
- ../../base

# https://fabianlee.org/2022/04/15/kubernetes-kustomize-transformations-with-patchesjson6902/
# https://github.com/fabianlee/kustomize-overlays-with-reload/blob/main/overlays/tiny-tools-ds-to-dep/kustomization.yaml
patches:
- target:
    kind: Deployment
    name: secret-service
  patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/image
      value: $SECRET_SERVICE_APP_IMAGE
    - op: add
      path: "/spec/template/spec/containers/0/env/-"
      value:
        name: VAULT_ADDR
        value: "$VAULT_ADDR"
    - op: add
      path: "/spec/template/spec/containers/0/env/-"
      value:
        name: VAULT_TOKEN
        value: "$VAULT_TOKEN"